<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Image Classification with Splinets • Splinets</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Image Classification with Splinets">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Splinets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ImageClassification.html">Image Classification with Splinets</a></li>
    <li><a class="dropdown-item" href="../articles/MassSpectrometry.html">Splinets Statistical Application: mass spectrometry</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Image Classification with Splinets</h1>
            
      

      <div class="d-none name"><code>ImageClassification.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Splinets</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data-preprocessing">Data Preprocessing<a class="anchor" aria-label="anchor" href="#data-preprocessing"></a>
</h2>
<p>This step involves transforming the two-dimensional images into a
one-dimensional format for analysis. The example in the source uses the
Hilbert curve transformation, which preserves local correlations between
image pixels better than simply stacking the image’s columns or rows</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#####################################</span></span>
<span><span class="co">#The code accompanying the R-journal paper on Splinets package</span></span>
<span><span class="co"># PART II - The code illustrating the classification workflow</span></span>
<span><span class="co">#####################################</span></span>
<span></span>
<span><span class="co">#####################################</span></span>
<span><span class="co">#STEP 1 - DATA PREPROCESSING</span></span>
<span><span class="co">##############</span></span>
<span><span class="co">#The Fashion MNIST are uploaded using the `keras` package</span></span>
<span><span class="co">#that in turn needs the `tensorflow` package</span></span>
<span></span>
<span><span class="co">##########</span></span>
<span><span class="co">#The following installations are needed merely to get access to the data</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"WorkFlowAuxFunction.R"</span><span class="op">)</span> <span class="co">#This source all important R-functions helping in the workflow, </span></span>
<span>                                <span class="co">#for example, 'data_upload()' and 'data_prep()' are defined in this file</span></span>
<span><span class="co"># fashion_mnist=data_upload(pathfile="../data/fashion_mnist.RData") #check parameters of this function </span></span>
<span>                                                               <span class="co">#in 'WorkFlowAuxFunction.R' if the data</span></span>
<span>                                                               <span class="co">#are not previously uploaded. </span></span>
<span></span>
<span><span class="co"># load(file = "../data/fashion_mnist.RData")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"fashion_mnist.RData"</span><span class="op">)</span></span>
<span><span class="co"># OneD=data_prep(dname='fashion_mnist')</span></span>
<span><span class="co"># save(OneD,file="OneD.RData")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"OneD.RData"</span><span class="op">)</span></span></code></pre></div>
<p>Once the data are properly formatted, we divided into three parts.
The first and largest part constitutes the training data, and the
remaining are split into two, the validation and testing.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Spliting the training data into classes</span></span>
<span><span class="va">K</span><span class="op">=</span><span class="fl">10</span></span>
<span><span class="va">ArgH</span><span class="op">=</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">60001</span><span class="op">]</span> <span class="co">#common vector of arguments </span></span>
<span><span class="va">ValH</span><span class="op">=</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">60000</span><span class="op">]</span> <span class="co">#values</span></span>
<span></span>
<span><span class="va">Htrain</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#the classes are made the elements of a list</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Htrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">ValH</span><span class="op">[</span>,<span class="va">fashion_mnist</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">y</span><span class="op">==</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>illustrating the two formats of the data against the original images
original images</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fashion_mnist</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">28</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,xaxt<span class="op">=</span><span class="st">"n"</span>,yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fashion_mnist</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">20</span>,<span class="fl">28</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,xaxt<span class="op">=</span><span class="st">"n"</span>,yaxt<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="images-transformed-by-vectorization">images transformed by vectorization<a class="anchor" aria-label="anchor" href="#images-transformed-by-vectorization"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OneD</span><span class="op">$</span><span class="va">coltrain</span><span class="op">[</span>,<span class="fl">60001</span><span class="op">]</span>,<span class="va">OneD</span><span class="op">$</span><span class="va">coltrain</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OneD</span><span class="op">$</span><span class="va">coltrain</span><span class="op">[</span>,<span class="fl">60001</span><span class="op">]</span>,<span class="va">OneD</span><span class="op">$</span><span class="va">coltrain</span><span class="op">[</span>,<span class="fl">20</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>images transformed by the Hilbert curve</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">60001</span><span class="op">]</span>,<span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">60001</span><span class="op">]</span>,<span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttrain</span><span class="op">[</span>,<span class="fl">20</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">''</span>,ylab<span class="op">=</span><span class="st">''</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<div class="section level3">
<h3 id="estimating-mean-values-of-discrete-data-">Estimating mean values of discrete data.<a class="anchor" aria-label="anchor" href="#estimating-mean-values-of-discrete-data-"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MeanTr</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="op">(</span><span class="fl">32</span><span class="op">*</span><span class="fl">32</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">MeanTr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">32</span><span class="op">*</span><span class="fl">32</span><span class="op">)</span>,<span class="va">k</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">Htrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="knot-selection-for-the-mean-and-the-centered-data">Knot selection for the mean and the centered data<a class="anchor" aria-label="anchor" href="#knot-selection-for-the-mean-and-the-centered-data"></a>
</h2>
<p>The Data-Driven Knots (DDK) selection algorithm is applied to the
training data to select class-specific knots. This algorithm identifies
areas of high curvature within each class and places knots accordingly,
minimizing the mean square error. This process is crucial for efficient
analysis and directly impacts the accuracy of the classification.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 2 Knot selection</span></span>
<span></span>
<span><span class="co"># The main work in this step is done by the 'DDK' package.</span></span>
<span><span class="co"># The critical function from this package is 'add_knots()'.</span></span>
<span></span>
<span><span class="co">#install.packages("devtools")</span></span>
<span><span class="co"># library(devtools)</span></span>
<span><span class="co"># devtools::install_github("ranibasna/ddk")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ranibasna.github.io/ddk/" class="external-link">DDK</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Generating fitting to the noise criterion for the stopping rule</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># AvRelErr=StopCurve() #the function is described in the sourced file, it takes some time.</span></span>
<span><span class="co"># save(AvRelErr,file = 'StCv.rda') #If planned to be used in the future it is good to save the results not run it again.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'StCv.rda'</span><span class="op">)</span></span>
<span><span class="co">########</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Running the code to select knots for the mean</span></span>
<span><span class="va">NInit</span><span class="op">=</span><span class="fl">10</span> <span class="co">#the number of the initial to be randomly chosen knots</span></span>
<span><span class="va">NKnt</span><span class="op">=</span><span class="fl">150</span><span class="op">+</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span></span>
<span><span class="co"># set.seed(1)</span></span>
<span><span class="co"># MnKnts=MeansKnots(MeanTr,ArgH,NKnt,NInit,AvRelErr,L=2)</span></span>
<span><span class="co"># save(MnKnts,file = 'MnKnts.rda') # save the knots for the mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'MnKnts.rda'</span><span class="op">)</span> <span class="co">#load the knots for the mean</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Running the code to select knots for the centered data</span></span>
<span><span class="va">NK</span><span class="op">=</span><span class="fl">1000</span></span>
<span><span class="va">CDTrain</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">CDTrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">Htrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="va">NK</span><span class="op">]</span></span>
<span>  <span class="va">CDTrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">CDTrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">-</span><span class="va">MeanTr</span><span class="op">[</span>,<span class="va">k</span><span class="op">]</span> <span class="co">#Centering the data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#The main part, selection of the knots for the centered data</span></span>
<span><span class="co"># CDKnts=CentDatKnots(CDTrain,AllKnts,MnKnts$knts,NKnt=150,AvRelErr)</span></span>
<span><span class="co"># save(CDKnts,file = 'CDKnts.rda') # save the knots for the centered data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'CDKnts.rda'</span><span class="op">)</span> <span class="co">#load the knots for the centered data </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="projecting-discrete-training-data-to-functional-spaces-of-splines">Projecting discrete training data to functional spaces of
splines<a class="anchor" aria-label="anchor" href="#projecting-discrete-training-data-to-functional-spaces-of-splines"></a>
</h2>
<p>Projecting Training Data Into Spline Spaces: The discrete training
data points are projected onto third-order data-driven splinet bases,
which are constructed based on the class-specific knots determined in
the previous step.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#####################################</span></span>
<span><span class="co">#STEP 3 - DATA PROJECTION TO SPLINE SPACES</span></span>
<span><span class="co">##############</span></span>
<span></span>
<span><span class="co"># Projecting means to the spline space</span></span>
<span><span class="co"># MeanSplines=list()</span></span>
<span><span class="co"># for(k in 1:K){</span></span>
<span><span class="co">#   MeanSplines[[k]]=project(cbind(ArgH,MeanTr[,k]),MnKnts$knts[[k]])</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #Projecting data -- this is time consuming</span></span>
<span><span class="co"># HSplns=list()</span></span>
<span><span class="co"># for(k in 1:K){</span></span>
<span><span class="co">#   HSplns[[k]]=project(cbind(ArgH,Htrain[[k]]),CDKnts$knts[[k]])</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span><span class="co"># save(MeanSplines,HSplns,file = 'Projections.rda') #save the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'Projections.rda'</span><span class="op">)</span> <span class="co">#load the results</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="illustrates-the-knot-selection-process">illustrates the knot selection process<a class="anchor" aria-label="anchor" href="#illustrates-the-knot-selection-process"></a>
</h2>
<p>Here we plot the selected knots for the mean functions and the
centered data.</p>
<p>Discrete mean ‘T-Shirt’ (solid line) vs. the functional fit μˆ
(dashed line) obtained by the optimal knots marked by vertical dotted
lines.</p>
<p>the mean `T-Shirt’</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">####################</span></span>
<span><span class="co">#FIGURES </span></span>
<span><span class="co">########</span></span>
<span></span>
<span></span>
<span><span class="va">k</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">prmean</span><span class="op">=</span><span class="va">MeanSplines</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prmean</span><span class="op">$</span><span class="va">sp</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">MeanTr</span><span class="op">[</span>,<span class="va">k</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="co">#T-shirt mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">prmean</span><span class="op">$</span><span class="va">sp</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/MeanTshirt-1.png" width="768"></p>
<p>Fitting the centered ‘T-shirt’ by a spline with selected knots,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prTSh</span><span class="op">=</span><span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">CDTrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="va">CDKnts</span><span class="op">$</span><span class="va">knts</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prTSh</span><span class="op">$</span><span class="va">sp</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">CDTrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="co">#T-shirt centered</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">prTSh</span><span class="op">$</span><span class="va">sp</span>,lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/CenteredTshirt-1.png" width="768"></p>
<ul>
<li>the stopping rule curve and the stopping time for the means</li>
</ul>
<p>Visualization of the stopping algorithm for the knots for the mean
functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NInit</span><span class="op">=</span><span class="fl">10</span>; <span class="va">KK</span><span class="op">=</span><span class="fl">150</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="va">KK</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,<span class="va">AvRelErr</span><span class="op">[</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="va">KK</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">'red'</span>,xlab<span class="op">=</span><span class="st">'Number of Selected Knots'</span>,ylab<span class="op">=</span><span class="st">'Relative Error Drop'</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">nonzerr</span><span class="op">=</span><span class="va">MnKnts</span><span class="op">$</span><span class="va">err</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="va">MnKnts</span><span class="op">$</span><span class="va">nknots</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">RelErr</span><span class="op">=</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">)</span><span class="op">/</span><span class="va">nonzerr</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">RelErr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">RelErr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">avpar</span><span class="op">=</span><span class="fl">3</span></span>
<span>  <span class="va">xx</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">RelErr</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">avpar</span>,<span class="va">avpar</span><span class="op">)</span>,sides<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">RelErr</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="va">xx</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RelErr</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,<span class="va">RelErr</span>,type<span class="op">=</span><span class="st">'l'</span>,col<span class="op">=</span><span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/StoppingRuleMean-1.png" width="768"></p>
<p>Visualization of the stopping algorithm for the knot selection of the
centered data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="va">KK</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,<span class="va">AvRelErr</span><span class="op">[</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">NInit</span><span class="op">+</span><span class="va">KK</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,type<span class="op">=</span><span class="st">'l'</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">'red'</span>,xlab<span class="op">=</span><span class="st">'Number of Selected Knots'</span>,ylab<span class="op">=</span><span class="st">'Relative Error Drop'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">nonzerr</span><span class="op">=</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">err</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">MnKnts</span><span class="op">$</span><span class="va">nknots</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">err</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">nonzerr</span><span class="op">[</span><span class="va">nonzerr</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">[</span><span class="va">nonzerr</span><span class="op">!=</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">[</span><span class="va">nonzerr</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">RelErr</span><span class="op">=</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">)</span><span class="op">/</span><span class="va">nonzerr</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">nonzerr</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">RelErr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">RelErr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="co">#xx=filter(RelErr,c(1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10,1/10),sides=1)</span></span>
<span>  <span class="va">avpar</span><span class="op">=</span><span class="fl">3</span></span>
<span>  <span class="va">xx</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">RelErr</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">avpar</span>,<span class="va">avpar</span><span class="op">)</span>,sides<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">RelErr</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">]</span><span class="op">=</span><span class="va">xx</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">MnKnts</span><span class="op">$</span><span class="va">nknots</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">:</span><span class="op">(</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">nknots</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="va">RelErr</span>,type<span class="op">=</span><span class="st">'l'</span>,col<span class="op">=</span><span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/StoppingRuleCentered-1.png" width="768"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#######</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="functional-principal-component-analysis">Functional Principal component analysis<a class="anchor" aria-label="anchor" href="#functional-principal-component-analysis"></a>
</h2>
<p>Functional Principal Components Analysis (FPCA) on Training Data:
FPCA is performed within each class on the functional data points of the
training set to understand the complexity of the data and prepare for
classification.</p>
<p>The spectral decomposition of the training data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">############################################</span></span>
<span><span class="co">#STEP 4 - PRINCIPAL COMPONENT ANALYSIS</span></span>
<span><span class="co">##############</span></span>
<span></span>
<span><span class="co">#Computing the covariance matrix of the isometric vectors from the `splinets' object</span></span>
<span></span>
<span><span class="va">Sig</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Spct</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Sig</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">HSplns</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coeff</span><span class="op">)</span> <span class="co">#The estimates of covariance </span></span>
<span>                                  <span class="co">#(variables as columns observations as rows)</span></span>
<span>  <span class="va">Spct</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">Sig</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#columns of Spct[[k]]$vectors are eigenvectors as columns</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#the end of STEP 4</span></span>
<span><span class="co">##########################################</span></span></code></pre></div>
<p>The first three eigenfunctions for the ‘T-shirt’ class scaled by the
square roots of the respective eigenfunctions.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#####################</span></span>
<span><span class="co">#FIGURE 7 - illustration of the role of eigenfunctions</span></span>
<span><span class="co">########</span></span>
<span><span class="va">k</span><span class="op">=</span><span class="fl">1</span> <span class="co">#T-Shirt</span></span>
<span></span>
<span><span class="co">#Eigenfunctions using 'Splinets'-package</span></span>
<span><span class="va">EigHSplns</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="va">HSplns</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">basis</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Spct</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">vectors</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="va">ScEHSp</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">EigHSplns</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Spct</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ScEHSp</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/IllustrationEigenfunctions-1.png" width="768"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#####</span></span></code></pre></div>
<p>Two approximations of the centered functional ‘T-shirt’ data point
(NavyBlue-Dashed Line): 1) by the first three eigenfunctions
(Blue-DottedDashed Line) ; 2) by the first twenty eigenfunctions
(Orange-ThinSolid Line).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="co">#Top-Left Graph: projections of the centered data</span></span>
<span></span>
<span><span class="va">k</span><span class="op">=</span><span class="fl">1</span></span>
<span><span class="va">HS1</span><span class="op">=</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">HSplns</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sp</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#Chosing the functional data point</span></span>
<span></span>
<span><span class="co">#Embeding mean to the spline space with the knots for eigenfunctions</span></span>
<span><span class="va">RFMeanSplines</span><span class="op">=</span><span class="fu"><a href="../reference/refine.html">refine</a></span><span class="op">(</span><span class="va">MeanSplines</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sp</span>,newknots<span class="op">=</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">knts</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Centering the data point</span></span>
<span><span class="va">CHS1</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">HS1</span>,<span class="va">RFMeanSplines</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">neg</span><span class="op">=</span><span class="fl">20</span> <span class="co">#The number 'neg' of the eigenfunctions</span></span>
<span><span class="va">EHSNeg</span><span class="op">=</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">EigHSplns</span>,<span class="fl">1</span><span class="op">:</span><span class="va">neg</span><span class="op">)</span> <span class="co">#Extracting `neg` eigenvalues</span></span>
<span></span>
<span><span class="va">A1</span><span class="op">=</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">RFMeanSplines</span>,<span class="va">EHSNeg</span><span class="op">)</span> <span class="co">#Combining the mean with the eigenfunctions</span></span>
<span><span class="va">A2</span><span class="op">=</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">A1</span>,<span class="va">CHS1</span><span class="op">)</span> <span class="co">#Adding the centered funtional data point</span></span>
<span><span class="va">IP</span><span class="op">=</span><span class="fu"><a href="../reference/gramian.html">gramian</a></span><span class="op">(</span><span class="va">A2</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co">#Aproximations of the centered data:</span></span>
<span><span class="va">CtAppNg</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="va">EHSNeg</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">IP</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">neg</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">2</span><span class="op">+</span><span class="va">neg</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co">#'neg' eigenvalues</span></span>
<span></span>
<span><span class="va">CtAppThree</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">EHSNeg</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">IP</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">+</span><span class="va">neg</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#three eigenvalues</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">CHS1</span>,sID<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">CtAppThree</span>,lty<span class="op">=</span><span class="st">'dotdash'</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">CtAppNg</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'darkorange3'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/IllustrationEigenfunctions_2-1.png" width="768"></p>
<p>The same approximation but centered around the ‘T-Shirt’ class mean
μˆ1 (Red-ThickSolid Line).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###</span></span>
<span><span class="co">#Bottom-Left - projections of the functional 'T-Shirt' data point centered around the class mean</span></span>
<span></span>
<span><span class="va">A</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">IP</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">neg</span><span class="op">)</span>,<span class="fl">2</span><span class="op">+</span><span class="va">neg</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#Coefficients of the projections to the eigenfunctions</span></span>
<span></span>
<span><span class="va">ApprxNeg</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="va">A1</span>,<span class="va">A</span><span class="op">)</span> <span class="co">#The approximation with the first `neg` eigenfunctions</span></span>
<span><span class="va">A1</span><span class="op">=</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">A1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="co">#Taking 3 eigenfunctions</span></span>
<span><span class="va">A</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">IP</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">+</span><span class="va">neg</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ApprxThree</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="va">A1</span>,<span class="va">A</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">HSplns</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sp</span>,sID<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">MeanSplines</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sp</span>,type<span class="op">=</span><span class="st">'l'</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="co">#Mean value spline</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ApprxThree</span>,lty<span class="op">=</span><span class="st">'dotdash'</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ApprxNeg</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'darkorange3'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/IllustrationEigenfunctions_3-1.png" width="768"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">###</span></span></code></pre></div>
<p>Projection of a ’Boot’ data point to the ’T-Shirt’ spectrum with 20
eigenfunctions after centering around the ’T-Shirt’ class mean, the
discrete‘Boot’ data point (Black-Rough Line) vs. the projection
(Orange-Solid Line).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Bottom-Right - projections to the 'T-Shirt' of the functional 'Boot' data point centered around the 'T-Shirt' class mean </span></span>
<span><span class="va">m</span><span class="op">=</span><span class="fl">10</span> <span class="co">#The boot clase</span></span>
<span></span>
<span><span class="va">Boot2TSh</span><span class="op">=</span><span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">Htrain</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="va">CDKnts</span><span class="op">$</span><span class="va">knts</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#projection of boots to 'T-Shirt'</span></span>
<span></span>
<span><span class="co">#Centering the 'Boot' data point with the 'T-Shirt' mean</span></span>
<span><span class="va">CDBoot2TSh</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">Boot2TSh</span><span class="op">$</span><span class="va">sp</span>,<span class="va">RFMeanSplines</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">A1</span><span class="op">=</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">RFMeanSplines</span>,<span class="va">EHSNeg</span><span class="op">)</span> <span class="co">#Combining the mean with the eigenfunctions</span></span>
<span><span class="va">A2</span><span class="op">=</span><span class="fu"><a href="../reference/gather.html">gather</a></span><span class="op">(</span><span class="va">A1</span>,<span class="va">CDBoot2TSh</span><span class="op">)</span> <span class="co">#Adding the centered funtional data point</span></span>
<span><span class="va">IP</span><span class="op">=</span><span class="fu"><a href="../reference/gramian.html">gramian</a></span><span class="op">(</span><span class="va">A2</span><span class="op">)</span>  </span>
<span><span class="va">A</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">IP</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">neg</span><span class="op">)</span>,<span class="fl">2</span><span class="op">+</span><span class="va">neg</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#Coefficients of the projections to the eigenfunctions</span></span>
<span></span>
<span><span class="va">ApprxNegB2T</span><span class="op">=</span><span class="fu"><a href="../reference/lincomb.html">lincomb</a></span><span class="op">(</span><span class="va">A1</span>,<span class="va">A</span><span class="op">)</span> <span class="co">#The approximation with the first `neg` eigenfunctions</span></span>
<span><span class="co">#pdf('Fig7BottomRight.pdf',width=7,height=4)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ApprxNegB2T</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">'darkorange3'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">Htrain</span><span class="op">[[</span><span class="va">m</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ImageClassification_files/figure-html/IllustrationEigenfunctions_4-1.png" width="768"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="determining-the-significant-number-of-the-eigenfunctions">Determining the significant number of the eigenfunctions<a class="anchor" aria-label="anchor" href="#determining-the-significant-number-of-the-eigenfunctions"></a>
</h2>
<p>This step uses the classification procedure on the validation data
set to ascertain the optimal number of eigenfunctions for each class.
This validation step is crucial for preventing overfitting and ensuring
accurate classification.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###########################################</span></span>
<span><span class="co">#STEP 5 - DETERMINING SIGNIFICANT NUMBER OF THE EIGENFUNCTIONS</span></span>
<span><span class="co">##############</span></span>
<span></span>
<span><span class="co">#Computing the covariance matrix of the isometric vectors from the `splinets' object</span></span>
<span><span class="co">#Preparing the arguments for Classify function</span></span>
<span></span>
<span><span class="co">#Embeding mean to the spline space with the knots for eigenfunctions</span></span>
<span><span class="va">Mean</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Mean</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/refine.html">refine</a></span><span class="op">(</span><span class="va">MeanSplines</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sp</span>,newknots<span class="op">=</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">knts</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span>  <span class="va">Mean</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">Mean</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span>,knots<span class="op">=</span><span class="va">CDKnts</span><span class="op">$</span><span class="va">knts</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#To get also the coefficients in the splinet</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># save(Mean,file='Mean.RData')</span></span>
<span><span class="co"># load('Mean.RData')</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#computing a list of eigenvectors based on 90% training data to make cross-validation 10% sample</span></span>
<span><span class="co">#unbiased on the computation of covariance</span></span>
<span><span class="va">CrossValid</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Eg</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">xy</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Htrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">ns</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">xy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span>,rep<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">#choosing a random sample for cross-validation</span></span>
<span>  <span class="va">NN</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">xy</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">CrossTrainCff</span><span class="op">=</span><span class="va">HSplns</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coeff</span> <span class="co">#Columnwise coefficients in the basis</span></span>
<span>  <span class="co">#removing 10% of the splines:</span></span>
<span>  <span class="va">CrossTrainCff</span><span class="op">=</span><span class="va">CrossTrainCff</span><span class="op">[</span><span class="op">-</span><span class="va">ns</span>,<span class="op">]</span></span>
<span>  <span class="va">CrossValid</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">Htrain</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">ns</span><span class="op">]</span> <span class="co">#Discrete 10% data on which crossvalidation is made</span></span>
<span>  </span>
<span>  <span class="va">Sigma</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">CrossTrainCff</span><span class="op">)</span></span>
<span>  <span class="va">Eg</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span> <span class="co">#columns of Eg[[k]]$vectors are eigenvectors</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># save(CrossValid,Eg,file='CrossValid.RData')</span></span>
<span><span class="co"># load('CrossValid.RData')</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#The initial run of classification, it also create the Spline representation of the data</span></span>
<span><span class="co">#that later significantly save time, when Classify is run again (it needs then to be given as the </span></span>
<span><span class="co">#last parameter to 'Classify()').</span></span>
<span></span>
<span><span class="co"># nn=rep(-1,K) #only knot selection utilized for classification</span></span>
<span><span class="co"># ClValue=list()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># for(k in 1:K){</span></span>
<span><span class="co">#   DiscrData=cbind(ArgH,CrossValid[[k]])</span></span>
<span><span class="co">#   ClValue[[k]]=Classify(DiscrData,Mean,Eg,nn)</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span><span class="co"># save(ClValue,file='ClValue.RData')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'ClValue.RData'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#the following yields the mean values of scaled distances for classes k=1,...,K</span></span>
<span><span class="co">#This is what classification one can get when only using the knot selection.</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ClValue</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">wghts</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 0.08558239</span></span>
<span><span class="co">#&gt; [1] 0.1026267</span></span>
<span><span class="co">#&gt; [1] 0.08864395</span></span>
<span><span class="co">#&gt; [1] 0.08985855</span></span>
<span><span class="co">#&gt; [1] 0.09073909</span></span>
<span><span class="co">#&gt; [1] 0.08843436</span></span>
<span><span class="co">#&gt; [1] 0.08072168</span></span>
<span><span class="co">#&gt; [1] 0.09398921</span></span>
<span><span class="co">#&gt; [1] 0.07503983</span></span>
<span><span class="co">#&gt; [1] 0.07505798</span></span>
<span></span>
<span><span class="va">SplData</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">SplData</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">ClValue</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">spldt</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#The beginning of searching for the optimal number of the eigenvalues</span></span>
<span><span class="va">nn</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">K</span><span class="op">)</span> <span class="co">#The means and the knots are used for classification</span></span>
<span><span class="va">ClValue</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">DiscrData</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ArgH</span>,<span class="va">CrossValid</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">ClValue</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="fu">Classify</span><span class="op">(</span><span class="va">DiscrData</span>,<span class="va">Mean</span>,<span class="va">Eg</span>,<span class="va">nn</span>,<span class="va">SplData</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#the following yields the mean values of scaled distances for classes k=1,...,K</span></span>
<span><span class="co">#This is what classification one can get when only using the mean and the knot selection.</span></span>
<span><span class="va">zz</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">#print(mean(ClValue[[k]]$wghts[k,]))</span></span>
<span>  <span class="va">zz</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ClValue</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cls</span><span class="op">==</span><span class="va">k</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ClValue</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">cls</span><span class="op">==</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 0.665</span></span>
<span><span class="co">#&gt; [1] 0.875</span></span>
<span><span class="co">#&gt; [1] 0.3283333</span></span>
<span><span class="co">#&gt; [1] 0.7116667</span></span>
<span><span class="co">#&gt; [1] 0.6566667</span></span>
<span><span class="co">#&gt; [1] 0.7516667</span></span>
<span><span class="co">#&gt; [1] 0.2283333</span></span>
<span><span class="co">#&gt; [1] 0.795</span></span>
<span><span class="co">#&gt; [1] 0.76</span></span>
<span><span class="co">#&gt; [1] 0.8633333</span></span></code></pre></div>
<!-- # Visualization of the optimization algorithm for the number of eigenfunctions -->
<!-- ```{r} -->
<!-- #################### -->
<!-- #Visualization of the optimization algorithm for the number of eigenfunctions -->
<!-- ####### -->
<!-- # objective function along the optimization trajectory -->
<!-- xval=ArgH #used due to the name of the default in 'Cross()' -->
<!-- nn=rep(0,K) -->
<!-- # CV1=Cross(nn=nn,NumbFail = 60) -->
<!-- # save(CV1,file='CV1.RData') -->
<!-- load('CV1.RData') -->
<!-- LT=length(CV1$Tr) -->
<!-- aaa=vector('numeric',LT) -->
<!-- for(i in 1:LT)aaa[i]=CV1$Lss[[i]] -->
<!-- # for(i in 1:LT)bbb[i]=sum(CV1$Tr[[i]]) -->
<!-- # plot(bbb,aaa,type='l',xlab='The number of eigenfunctions',ylab='Accuracy',col='red',lwd=2,ylim=c(0.65,0.8)) -->
<!-- ``` -->
<!-- ```{r MC} -->
<!-- MC=10 #Monte Carlo sample for the ini -->
<!-- MxAccu=vector('numeric',MC+1) -->
<!-- MxAccuArg=matrix(0,ncol=MC+1,nrow=K) -->
<!-- ind=1:LT -->
<!-- nn0=min(ind[max(aaa)==aaa]) -->
<!-- MxAccu[1]=CV1$Lss[[nn0]] -->
<!-- MxAccuArg[,1]=CV1$Tr[[nn0]] -->
<!-- # set.seed(1) -->
<!-- # for(j in 1:MC){ -->
<!-- #   newn=nn -->
<!-- #   for(k in 1:K){ -->
<!-- #     newn[k]=ceiling(runif(1)*MxAccuArg[k,j]) -->
<!-- #   } -->
<!-- #   CV1=Cross(nn=newn,NumbFail = 40) -->
<!-- #   LT=length(CV1$Tr) -->
<!-- #   aaa=vector('numeric',LT) -->
<!-- #   bbb=aaa -->
<!-- #   for(i in 1:LT)aaa[i]=CV1$Lss[[i]] -->
<!-- #   for(i in 1:LT)bbb[i]=sum(CV1$Tr[[i]]) -->
<!-- #   plot(bbb,aaa,type='l',xlab='The number of eigenfunctions',ylab='Accuracy',col='red',lwd=2,ylim=c(0.65,0.8)) -->
<!-- #   lines(bbb,aaa,type='l',col=j) -->
<!-- #   ind=1:LT -->
<!-- #   nn0=min(ind[max(aaa)==aaa]) -->
<!-- #   MxAccu[j+1]=CV1$Lss[[nn0]] -->
<!-- #   MxAccuArg[,j+1]=CV1$Tr[[nn0]] -->
<!-- # } -->
<!-- # save(CV1,MxAccu,MxAccuArg,file='MxAccu.RData') -->
<!-- # rm(CV1) -->
<!-- load('MxAccu.RData') -->
<!-- LT=length(CV1$Tr) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #The optimal number of the eigenfunction and its classwise decomposition -->
<!-- jjj=1:(MC+1) -->
<!-- j0=min(jjj[MxAccu==max(MxAccu)]) -->
<!-- MxAccu[j0] -->
<!-- nn0=MxAccuArg[,j0] -->
<!-- sum(nn0) -->
<!-- #obtaining classwise trajectories -->
<!-- # ClassTraj=matrix(0,nrow=K,ncol=LT) -->
<!-- #  -->
<!-- # for(k in 1:K){ -->
<!-- #   DiscrData=cbind(ArgH,CrossValid[[k]]) -->
<!-- #   for(i in 1:LT){ -->
<!-- #     AB=Classify(DiscrData,Mean,Eg,CV1$Tr[[i]],SplData[[k]]) -->
<!-- #     ClassTraj[k,i]=mean(AB$clss==k) -->
<!-- #   } -->
<!-- # } -->
<!-- # save(ClassTraj,file='ClassTraj.RData') -->
<!-- load('ClassTraj.RData') -->
<!-- xxx=sum(CV1$Tr[[1]]):sum(CV1$Tr[[LT]]) #the trajectory range by the total number of eigenfunctions -->
<!-- ####### -->
<!-- # the objective function against classwise accuracy -->
<!-- plot(xxx,aaa,ylim=c(0,1),type='l',axes='False',lwd=3, col='red',ylab='Accuracy',xlab='The total number of eigenfunctions') -->
<!-- axis(1) -->
<!-- axis(2) -->
<!-- for(k in 1:K){ -->
<!--   lines(xxx,ClassTraj[k,],type='l',col=k) -->
<!-- } -->
<!-- lines(xxx,aaa,lwd=3, col='red') -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="testing-the-classification-procedure">Testing the Classification Procedure<a class="anchor" aria-label="anchor" href="#testing-the-classification-procedure"></a>
</h2>
<p>The testing step involves classifying each data point in the testing
set by projecting it onto the ten functional spaces and utilizing the
classification rule. The results are then compared with the actual class
memberships and summarized in the confusion matrix to assess the
method’s efficiency.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#############################################</span></span>
<span></span>
<span></span>
<span><span class="co">#Preparation of the testing data sets</span></span>
<span><span class="co">#Spliting the testing data into classes </span></span>
<span><span class="va">ArgH</span><span class="op">=</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttest</span><span class="op">[</span>,<span class="fl">10001</span><span class="op">]</span> <span class="co">#common vector of arguments </span></span>
<span><span class="va">TestH</span><span class="op">=</span><span class="va">OneD</span><span class="op">$</span><span class="va">Hilberttest</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10000</span><span class="op">]</span> </span>
<span></span>
<span><span class="va">Htest</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#the classes become elements of a list</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Htest</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">TestH</span><span class="op">[</span>,<span class="va">fashion_mnist</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">y</span><span class="op">==</span><span class="op">(</span><span class="va">k</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="op">}</span></span>
<span><span class="co">#end of the testing data preparation</span></span></code></pre></div>
<div class="section level3">
<h3 id="classification-of-the-testing-data">Classification of the testing data<a class="anchor" aria-label="anchor" href="#classification-of-the-testing-data"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Running the test of the classification procedure on testing data, takes some time.</span></span>
<span><span class="co"># TesT=list()</span></span>
<span><span class="co"># for(k in 1:K){</span></span>
<span><span class="co">#   DiscrData=cbind(ArgH,Htest[[k]])</span></span>
<span><span class="co">#   TesT[[k]]=Classify(DiscrData,Mean,Spct,nn0) #nn0-contains the number of eigenvectors for each class</span></span>
<span><span class="co">#                                               #Spct - the spectrum based on all training data</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span><span class="co"># save(TesT,file='TesT.RData')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">'TesT.RData'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Acc</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'numeric'</span>,<span class="va">K</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Acc</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TesT</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clss</span><span class="op">==</span><span class="va">k</span><span class="op">)</span> <span class="co">#Computing accuracies per class</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Acc</span><span class="op">*</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Acc</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.5547374 0.7293912 0.4631788 0.6285998 0.5039570 0.6647616 0.2731370</span></span>
<span><span class="co">#&gt;  [8] 0.7001540 0.7009234 0.7009234</span></span>
<span></span>
<span><span class="va">Dist</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'numeric'</span>,<span class="va">K</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Dist</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TesT</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">wghts</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span><span class="op">)</span> <span class="co">#Computing distances per class</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Dist</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.054 0.047 0.056 0.051 0.050 0.046 0.063 0.028 0.047 0.028</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="final-evaluation-and-conclusions">Final evaluation and conclusions<a class="anchor" aria-label="anchor" href="#final-evaluation-and-conclusions"></a>
</h2>
<p>Final Evaluation and Conclusions: This stage is case-specific and
depends on the goal of the analysis. It involves analyzing the
classification results, examining misclassified data points, and
identifying potential areas for improvement.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#############################################</span></span>
<span></span>
<span><span class="co">#Creating values to the confusion matrix</span></span>
<span></span>
<span><span class="va">Confusion</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,ncol<span class="op">=</span><span class="va">K</span>,nrow<span class="op">=</span><span class="va">K</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">l</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Confusion</span><span class="op">[</span><span class="va">l</span>,<span class="va">k</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">TesT</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clss</span><span class="op">==</span><span class="va">l</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rani Basna, Xijia Liu, Hiba Nassar, Krzysztof Podgorski, Hanqing Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
